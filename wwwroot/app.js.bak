const e = React.createElement;

function Questionnaire() {
  const [questions, setQuestions] = React.useState([]);
  const [answers, setAnswers] = React.useState({});
  const [submitted, setSubmitted] = React.useState(false);

  React.useEffect(() => {
    fetch('/api/question')
      .then(res => res.json())
      .then(data => setQuestions(data))
      .catch(err => console.error(err));
  }, []);

  function handleChange(qid, value) {
    setAnswers(prev => ({ ...prev, [qid]: value }));
  }

  function handleSubmit(evt) {
    evt.preventDefault();
    const payload = Object.keys(answers).map(k => ({ QuestionId: parseInt(k), AnswerText: answers[k] }));

    fetch('/api/question/answers', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
      .then(res => {
        if (res.ok) setSubmitted(true);
        else alert('Ошибка при отправке');
      })
      .catch(err => {
        console.error(err);
        alert('Ошибка при отправке');
      });
  }

  if (submitted) return e('div', null, 'Спасибо!');

  return e('form', { onSubmit: handleSubmit },
    questions.map(q => {
      if (q.type === 'text') {
        return e('div', { key: q.id },
          e('label', null, q.text),
          e('br'),
          e('input', { type: 'text', value: answers[q.id] || '', onChange: (ev) => handleChange(q.id, ev.target.value) })
        );
      }

      if (q.type === 'radio') {
        return e('div', { key: q.id },
          e('div', null, q.text),
          q.options && q.options.map((opt, idx) =>
            e('label', { key: idx },
              e('input', { type: 'radio', name: 'q' + q.id, value: opt, checked: answers[q.id] === opt, onChange: () => handleChange(q.id, opt) }),
              opt
            )
          )
        );
      }

      return null;
    }),
    e('div', null,
      e('button', { type: 'submit' }, 'Отправить')
    )
  );
}

const domContainer = document.querySelector('#root');
ReactDOM.createRoot(domContainer).render(e(Questionnaire));

<script type="text/babel" src="/app.js"></script>
